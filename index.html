<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mistik Falçı (ChatGPT)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Quicksand:wght@300;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Quicksand', sans-serif;
            background-color: #0f0c29;
            background-image: linear-gradient(315deg, #0f0c29 0%, #302b63 74%, #24243e 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }
        .mystic-font { font-family: 'Cinzel', serif; }
        .crystal-ball-container { position: relative; width: 250px; height: 250px; margin: 0 auto; perspective: 1000px; }
        .crystal-ball {
            width: 100%; height: 100%; border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.1), rgba(0, 0, 0, 0.4) 40%, rgba(0, 0, 0, 0.8) 80%);
            box-shadow: 0 0 30px rgba(138, 43, 226, 0.3), inset 0 0 50px rgba(138, 43, 226, 0.2);
            position: relative; z-index: 2; transition: all 0.5s ease; cursor: pointer; display: flex; align-items: center; justify-content: center; overflow: hidden;
        }
        .crystal-ball::after {
            content: ''; position: absolute; top: 5%; left: 10%; width: 25%; height: 15%; border-radius: 50%;
            background: radial-gradient(ellipse at center, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0) 70%);
            transform: rotate(-45deg); filter: blur(2px);
        }
        .crystal-ball-stand {
            width: 160px; height: 60px; background: linear-gradient(to bottom, #4a3b2a, #2c241b); margin: -20px auto 0;
            border-radius: 50%; position: relative; z-index: 1; box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }
        .fog {
            position: absolute; width: 200%; height: 200%;
            background: url('https://raw.githubusercontent.com/hiteshchoudhary/apihub/master/assets/images/smoke.png'); 
            background-size: cover; opacity: 0; mix-blend-mode: color-dodge;
        }
        @keyframes fogMove {
            0% { transform: translate(-10%, -10%) rotate(0deg); opacity: 0.3; }
            50% { transform: translate(10%, 10%) rotate(180deg); opacity: 0.6; }
            100% { transform: translate(-10%, -10%) rotate(360deg); opacity: 0.3; }
        }
        .glowing { box-shadow: 0 0 60px rgba(138, 43, 226, 0.6), inset 0 0 80px rgba(138, 43, 226, 0.4); }
        .glowing .fog { opacity: 0.5; animation: fogMove 6s infinite linear; }
        .stars { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
        .star { position: absolute; background: white; border-radius: 50%; opacity: 0.5; animation: twinkle var(--duration) infinite ease-in-out; }
        @keyframes twinkle { 0%, 100% { opacity: 0.2; transform: scale(0.8); } 50% { opacity: 1; transform: scale(1.2); } }
        .result-text { text-shadow: 0 0 10px rgba(255, 255, 255, 0.5); }
        .fade-in { animation: fadeIn 1s ease-in forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="flex flex-col items-center justify-center p-4">

    <div id="stars" class="stars"></div>

    <header class="text-center mb-8 z-10">
        <h1 class="text-4xl md:text-6xl text-purple-300 mystic-font mb-2">Mistik Falçı</h1>
        <p class="text-purple-200 text-sm md:text-lg opacity-80">ChatGPT Gələcəyi Görür...</p>
    </header>

    <main class="w-full max-w-md z-10 flex flex-col items-center">
        
        <div id="input-section" class="w-full bg-black/30 backdrop-blur-sm p-6 rounded-xl border border-purple-500/30 mb-8 transition-all duration-500">
            <div class="mb-4">
                <label class="block text-purple-300 text-sm mb-2 mystic-font">Adın</label>
                <input type="text" id="username" placeholder="Məs: Ayan" class="w-full bg-purple-900/20 border border-purple-500/50 rounded px-4 py-2 text-white focus:outline-none focus:border-purple-400 transition-colors">
            </div>
            <div class="mb-4">
                <label class="block text-purple-300 text-sm mb-2 mystic-font">Sualın</label>
                <input type="text" id="question" placeholder="Məs: Məni gələcəkdə nə gözləyir?" class="w-full bg-purple-900/20 border border-purple-500/50 rounded px-4 py-2 text-white focus:outline-none focus:border-purple-400 transition-colors">
            </div>
            <button id="predictButton" class="w-full bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-500 hover:to-indigo-500 text-white font-bold py-3 px-4 rounded shadow-lg transform transition hover:scale-105 mystic-font">
                Büllur Kürəyə Bax
            </button>
        </div>

        <div class="crystal-ball-container mb-8" id="ball-container">
            <div class="crystal-ball border-4 border-purple-900/50" id="crystal-ball">
                <div class="fog"></div>
                <div id="ball-center-text" class="text-6xl opacity-20 text-purple-300">?</div>
            </div>
            <div class="crystal-ball-stand"></div>
        </div>

        <div id="result-section" class="hidden w-full text-center bg-black/40 backdrop-blur-md p-6 rounded-xl border border-purple-400/50 shadow-[0_0_20px_rgba(147,51,234,0.3)]">
            <h3 class="text-xl text-purple-300 mystic-font mb-4">Kürənin Cavabı:</h3>
            <p id="prediction-text" class="text-lg md:text-xl font-light text-white leading-relaxed result-text mb-6 min-h-[80px] flex items-center justify-center"></p>
            <button onclick="reset()" class="text-sm text-purple-300 hover:text-white underline decoration-dotted">
                Başqa sual ver
            </button>
        </div>
    </main>

    <script>
        const ball = document.getElementById('crystal-ball');
        const inputSection = document.getElementById('input-section');
        const resultSection = document.getElementById('result-section');
        const predictionText = document.getElementById('prediction-text');
        const ballCenterText = document.getElementById('ball-center-text');
        const usernameInput = document.getElementById('username');
        const questionInput = document.getElementById('question');
        const predictButton = document.getElementById('predictButton');

        // Ulduzlar
        const starsContainer = document.getElementById('stars');
        for(let i = 0; i < 50; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            star.style.left = `${Math.random() * 100}%`;
            star.style.top = `${Math.random() * 100}%`;
            star.style.width = `${Math.random() * 3}px`;
            star.style.height = star.style.width;
            star.style.setProperty('--duration', `${2 + Math.random() * 3}s`);
            starsContainer.appendChild(star);
        }

        predictButton.addEventListener('click', startPrediction);
        window.reset = reset;

        async function startPrediction() {
            const name = usernameInput.value.trim();
            const question = questionInput.value.trim();

            if (!name) {
                alert("Zəhmət olmasa, adınızı qeyd edin...");
                return;
            }

            inputSection.style.opacity = '0';
            setTimeout(() => inputSection.classList.add('hidden'), 500);
            
            ball.classList.add('glowing');
            ballCenterText.style.opacity = '0';

            let steps = 0;
            const animationInterval = setInterval(() => {
                steps++;
                const hue = (steps * 10) % 360;
                ball.style.boxShadow = `0 0 80px hsla(${hue}, 70%, 50%, 0.6), inset 0 0 80px hsla(${hue}, 70%, 50%, 0.4)`;
            }, 100);

            try {
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, question })
                });

                const data = await response.json();
                clearInterval(animationInterval);

                if (data.error) {
                    showResult("Xəta baş verdi: " + data.error);
                } else {
                    showResult(data.result);
                }

            } catch (error) {
                console.error("Xəta:", error);
                clearInterval(animationInterval);
                showResult("Kürə dumanlıdır, əlaqə kəsildi.");
            }
        }

        function showResult(text) {
            ball.classList.remove('glowing');
            ball.style.boxShadow = ''; 
            resultSection.classList.remove('hidden');
            resultSection.classList.add('fade-in');
            predictionText.innerHTML = "";
            let i = 0;
            function typeWriter() {
                if (i < text.length) {
                    predictionText.innerHTML += text.charAt(i);
                    i++;
                    setTimeout(typeWriter, 30);
                }
            }
            typeWriter();
        }

        function reset() {
            resultSection.classList.add('hidden');
            resultSection.classList.remove('fade-in');
            inputSection.classList.remove('hidden');
            setTimeout(() => inputSection.style.opacity = '1', 100);
            ballCenterText.style.opacity = '0.2';
            questionInput.value = '';
        }
    </script>
</body>
</html>
